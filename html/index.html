<html>

  <meta charset="utf-8">

<head>

<title>Group 1 BlackJack</title>

<link rel="stylesheet" href="page_style.css">

</head>

<h1>________</h1>
<h2><p style="text-align: center;">Welcome Player!</p></h2>
<h3><p style="text-align: right;">Dealer:</p></h3>
<body>

  

  <img id="card1" src="AD.svg" width= "150px" class="fix">
  <img id="card2" src="AD.svg" width="150px" class="fix2">

  <img id="card3" src="9C.svg" width= "150px" class="fix3">
  <img id="card4" src="AH.svg" width="150px" class="fix4">

  <div id = "hitInput">
   <button id="hitbutton" onclick="functionToExecute('Hit')">Hit</button>
  </div>

  <div id = "standInput">
   <button onclick="functionToExecute('Stand')">Stand</button>
  </div>

  <div id = "splitInput">
   <button onclick="functionToExecute('Split')">Split</button>
  </div>

  <div id = "foldInput">
    <button onclick="functionToExecute('Fold')">Fold</button>
   </div>

   <div id = "hintInput">
    <button onclick="functionToExecute('Hint')">Hint</button>
  </div>

   <div id="betInput">
    <p>name: <input id="sendBet" type="text">
      <input type="button" name="sendBet" value="Bet" onclick="sendBet()">
    </p>
  </div>

  





</html>

<script type="text/javascript">

class UserEvent {
     constructor(){
           this.eventType = 'HIT';

     }

      userEvent(eventName){
        this.eventType = eventName;
     }
}
var connection = null;
var serverURL;

serverUrl = "ws://" + window.location.hostname + ":9881";
//serverUrl = "ws://" + "localhost" + ":9881";

connection = new WebSocket(serverUrl);
connection.onopen = function(evt){

console.log("open");

}

var cardIdx = 0;
var playerID = 0;
var amount =0;
var currentTurn = 0;
connection.onmessage = function (evt){//not quite sure what evt is and thus I'm not really sure what evt.data is and what that makes msg

var msg;
msg = evt.data;

console.log("Message received: ");


  const obj = JSON.parse(msg); //This makes an obj out of what Json parses from msg
    if (!obj.players) {

      p
      console.log("player ID = " + playerID);
     //now this message acts as a debug, it's showing on our website right now so it must mean the obj is not a game with players?
      
    }
    else { 
      
      let header = document.querySelector("h2");
      header.innerText = "You are Player " + playerID; 
      const suite_to_char = new Map();

      suite_to_char.set("SPADES", "S");
      suite_to_char.set("HEARTS", "H");
      suite_to_char.set("DIAMONDS", "D");
      suite_to_char.set("CLUBS", "C");

      const value_to_char = new Map();
      value_to_char.set("Ace","A");
      value_to_char.set("Two", "2");
      value_to_char.set("Three", "3");
      value_to_char.set("Four", "4");
      value_to_char.set("Five", "5");
      value_to_char.set("Six", "6");
      value_to_char.set("Seven", "7");
      value_to_char.set("Eight", "8");
      value_to_char.set("Nine", "9");
      value_to_char.set("Ten", "T");
      value_to_char.set("Jack", "J");
      value_to_char.set("Queen", "Q");
      value_to_char.set("King", "K");
   // playerID++;
 console.log("dumping game state")
      for (const player of obj.players) {
        console.log("id =" + player.playerID);

        // only show the cards for this player
        if (playerID == player.playerID) {

          var i = 0;
          for (const card of player.pHand) {
            console.log("Card =" + card.cardsuit + "  " + card.cardvalue);

            var filename = value_to_char.get(card.cardvalue) + suite_to_char.get(card.cardsuit) + ".svg";
            console.log(filename);
            var element = "card" + (i + 1);

            document.getElementById(element).src = filename;
            i++;
          }  // each card
        } // player id matches
      } // each player
    } // this is game state
  }



  function send() {

    var msg = {
      text: document.getElementById("send_text").value,
    };
    connection.send(JSON.stringify(msg));
    console.log(JSON.stringify(msg));
  }
  function sendName() {

    var msg = {
      event: "NAME",
      name: document.getElementById("sendName").value,
      playerID: playerID
    };
  }
function sendBet(){
       var msg = {
         event: "BET",
         bet: document.getElementById("sendBet").value,
         amount: amount    
       };
    
    connection.send(JSON.stringify(msg));
    console.log(JSON.stringify(msg));

}

    
/*This is me trying to add functionality to our Hit button
but I'm not sure if I'm doing it right because "E" isn't being recognized as a new variable*/


     function functionToExecute(s) {
        const  E = new UserEvent();
          if (s==="Hit") {
            E.userEvent('HIT');

          }
          if(s ==="Stand"){
            E.userEvent('STAND');

          }
          if(s==="Split"){
            E.userEvent('SPLIT');

          }
          if(s==="Fold"){
            E.userEvent('FOLD');

          }
          connection.send(JSON.stringify(E));
          console.log(JSON.stringify(E));
      }   



//document.body.appendChild(btn);
//    var x = document.getElementById("nameInput");
//    if (x.style.display === "none") {
//      x.style.display = "block";
//    } else {
//      x.style.display = "inline";
//    }

  

</script>
</body>

  
